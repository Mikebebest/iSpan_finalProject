<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Voice Command Monitor</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    #status { color: green; font-weight: bold; margin-bottom: 20px; }
    #text { font-size: 24px; font-weight: bold; margin-top: 20px; display: none; }
    #alert { font-size: 32px; font-weight: bold; margin-top: 20px; display: none; }
    .emergency { color: red; }
    .light-on { color: dodgerblue; }
    .light-off { color: orange; }
  </style>
</head>
<body>
  <h1>Voice Control Monitor</h1>
  <p id="status">ğŸŸ¢ èƒŒæ™¯ç›£è½ä¸­...</p>
  <p id="alert"></p>
  <p id="text"></p>

  <script>
    const serverIP = "192.168.137.78"; // ä½ çš„server IP
    const ws = new WebSocket(`ws://${serverIP}:8081`);
    const textElement = document.getElementById('text');
    const alertElement = document.getElementById('alert');

    ws.onopen = () => {
      console.log(`ğŸŸ¢ WebSocket connected to ${serverIP}:8081`);
    };

    ws.onmessage = (event) => {
      const text = event.data.trim().toLowerCase();
      console.log("æ”¶åˆ°èªéŸ³æ–‡å­—:", text);

      alertElement.style.display = 'none';
      textElement.style.display = 'block';
      textElement.textContent = `ğŸ¤ è¾¨è­˜åˆ°: ${text}`;
      textElement.style.color = "black"; // ä¸€èˆ¬é¡¯ç¤ºé»‘è‰²

      if (text.includes("help")) {
        alertElement.style.display = 'block';
        alertElement.textContent = "ğŸš¨ EMERGENCY! ç·Šæ€¥ç‹€æ³ ğŸš¨";
        alertElement.className = 'emergency';
        sendCommand("emergency");
      } else if (text.includes("hello")) {
        alertElement.style.display = 'block';
        alertElement.textContent = "ğŸ’¡ é–‹ç‡ˆæŒ‡ä»¤å·²é€å‡ºï¼";
        alertElement.className = 'light-on';
        sendCommand("light on");
      } else if (text.includes("bye bye")) {
        alertElement.style.display = 'block';
        alertElement.textContent = "ğŸ’¤ é—œç‡ˆæŒ‡ä»¤å·²é€å‡ºï¼";
        alertElement.className = 'light-off';
        sendCommand("light off");
      }
    };

    function sendCommand(cmd) {
      fetch(`http://${serverIP}:8080/send?cmd=${encodeURIComponent(cmd)}`)
        .then(res => {
          if (res.ok) console.log(`âœ… æŒ‡ä»¤ ${cmd} å·²é€å‡º`);
          else console.error(`âŒ æŒ‡ä»¤ ${cmd} ç™¼é€å¤±æ•—`);
        })
        .catch(err => {
          console.error(`âŒ æŒ‡ä»¤ç™¼é€éŒ¯èª¤:`, err);
        });
    }
  </script>
</body>
</html>
